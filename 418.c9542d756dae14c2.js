"use strict";(self.webpackChunkl_admin_angular=self.webpackChunkl_admin_angular||[]).push([[418],{8418:(ht,_,o)=>{o.r(_),o.d(_,{default:()=>mt});var x=o(6814),p=o(6223),S=o(6254),D=o(8125),A=o(4139),O=o(2840),T=o(824),v=o(7582),N=o(6028),e=o(5879),k=o(8645),g=o(2438),R=o(3019),B=o(3997),b=o(9773),M=o(9087),z=o(7754),w=o(4300),P=o(9388),y=o(883),F=o(2595),V=o(8324);const L=["upHandler"],U=["downHandler"],J=["inputElement"];function $(i,r){if(1&i&&e._UZ(0,"nz-form-item-feedback-icon",11),2&i){const t=e.oxw();e.Q6J("status",t.status)}}let st=(()=>{class i{onModelChange(t){this.parsedValue=this.nzParser(t),this.inputElement.nativeElement.value=`${this.parsedValue}`;const n=this.getCurrentValidValue(this.parsedValue);this.setValue(n)}getCurrentValidValue(t){let n=t;return n=""===n?"":this.isNotCompleteNumber(n)?this.value:`${this.getValidValue(n)}`,this.toNumber(n)}isNotCompleteNumber(t){return isNaN(t)||""===t||null===t||!(!t||t.toString().indexOf(".")!==t.toString().length-1)}getValidValue(t){let n=parseFloat(t);return isNaN(n)?t:(n<this.nzMin&&(n=this.nzMin),n>this.nzMax&&(n=this.nzMax),n)}toNumber(t){if(this.isNotCompleteNumber(t))return t;const n=String(t);if(n.indexOf(".")>=0&&(0,z.DX)(this.nzPrecision)){if("function"==typeof this.nzPrecisionMode)return this.nzPrecisionMode(t,this.nzPrecision);if("cut"===this.nzPrecisionMode){const s=n.split(".");return s[1]=s[1].slice(0,this.nzPrecision),Number(s.join("."))}return Number(Number(t).toFixed(this.nzPrecision))}return Number(t)}getRatio(t){let n=1;return t.metaKey||t.ctrlKey?n=.1:t.shiftKey&&(n=10),n}down(t,n){this.isFocused||this.focus(),this.step("down",t,n)}up(t,n){this.isFocused||this.focus(),this.step("up",t,n)}getPrecision(t){const n=t.toString();if(n.indexOf("e-")>=0)return parseInt(n.slice(n.indexOf("e-")+2),10);let s=0;return n.indexOf(".")>=0&&(s=n.length-n.indexOf(".")-1),s}getMaxPrecision(t,n){if((0,z.DX)(this.nzPrecision))return this.nzPrecision;const s=this.getPrecision(n),a=this.getPrecision(this.nzStep),u=this.getPrecision(t);return t?Math.max(u,s+a):s+a}getPrecisionFactor(t,n){const s=this.getMaxPrecision(t,n);return Math.pow(10,s)}upStep(t,n){const s=this.getPrecisionFactor(t,n),a=Math.abs(this.getMaxPrecision(t,n));let u;return u="number"==typeof t?((s*t+s*this.nzStep*n)/s).toFixed(a):this.nzMin===-1/0?this.nzStep:this.nzMin,this.toNumber(u)}downStep(t,n){const s=this.getPrecisionFactor(t,n),a=Math.abs(this.getMaxPrecision(t,n));let u;return u="number"==typeof t?((s*t-s*this.nzStep*n)/s).toFixed(a):this.nzMin===-1/0?-this.nzStep:this.nzMin,this.toNumber(u)}step(t,n,s=1){if(this.stop(),n.preventDefault(),this.nzDisabled)return;const a=this.getCurrentValidValue(this.parsedValue)||0;let u=0;"up"===t?u=this.upStep(a,s):"down"===t&&(u=this.downStep(a,s));const f=u>this.nzMax||u<this.nzMin;u>this.nzMax?u=this.nzMax:u<this.nzMin&&(u=this.nzMin),this.setValue(u),this.updateDisplayValue(u),this.isFocused=!0,!f&&(this.autoStepTimer=setTimeout(()=>{this[t](n,s)},300))}stop(){this.autoStepTimer&&clearTimeout(this.autoStepTimer)}setValue(t){if(`${this.value}`!=`${t}`&&this.onChange(t),this.value=t,this.parsedValue=t,this.disabledUp=this.disabledDown=!1,t||0===t){const n=Number(t);n>=this.nzMax&&(this.disabledUp=!0),n<=this.nzMin&&(this.disabledDown=!0)}}updateDisplayValue(t){const n=(0,z.DX)(this.nzFormatter(t))?this.nzFormatter(t):"";this.displayValue=n,this.inputElement.nativeElement.value=`${n}`}writeValue(t){this.value=t,this.setValue(t),this.updateDisplayValue(t),this.cdr.markForCheck()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.nzDisabled=this.isNzDisableFirstChange&&this.nzDisabled||t,this.isNzDisableFirstChange=!1,this.disabled$.next(this.nzDisabled),this.cdr.markForCheck()}focus(){this.focusMonitor.focusVia(this.inputElement,"keyboard")}blur(){this.inputElement.nativeElement.blur()}constructor(t,n,s,a,u,f,h,l,c){this.ngZone=t,this.elementRef=n,this.cdr=s,this.focusMonitor=a,this.renderer=u,this.directionality=f,this.destroy$=h,this.nzFormStatusService=l,this.nzFormNoStatusService=c,this.isNzDisableFirstChange=!0,this.isFocused=!1,this.disabled$=new k.x,this.disabledUp=!1,this.disabledDown=!1,this.dir="ltr",this.prefixCls="ant-input-number",this.status="",this.statusCls={},this.hasFeedback=!1,this.onChange=()=>{},this.onTouched=()=>{},this.nzBlur=new e.vpe,this.nzFocus=new e.vpe,this.nzSize="default",this.nzMin=-1/0,this.nzMax=1/0,this.nzParser=d=>d.trim().replace(/\u3002/g,".").replace(/[^\w\.-]+/g,""),this.nzPrecisionMode="toFixed",this.nzPlaceHolder="",this.nzStatus="",this.nzStep=1,this.nzInputMode="decimal",this.nzId=null,this.nzDisabled=!1,this.nzReadOnly=!1,this.nzAutoFocus=!1,this.nzBorderless=!1,this.nzFormatter=d=>d}ngOnInit(){this.nzFormStatusService?.formStatusChanges.pipe((0,B.x)((t,n)=>t.status===n.status&&t.hasFeedback===n.hasFeedback),(0,b.R)(this.destroy$)).subscribe(({status:t,hasFeedback:n})=>{this.setStatusStyles(t,n)}),this.focusMonitor.monitor(this.elementRef,!0).pipe((0,b.R)(this.destroy$)).subscribe(t=>{t?(this.isFocused=!0,this.nzFocus.emit()):(this.isFocused=!1,this.updateDisplayValue(this.value),this.nzBlur.emit(),Promise.resolve().then(()=>this.onTouched()))}),this.dir=this.directionality.value,this.directionality.change.pipe((0,b.R)(this.destroy$)).subscribe(t=>{this.dir=t}),this.setupHandlersListeners(),this.ngZone.runOutsideAngular(()=>{(0,g.R)(this.inputElement.nativeElement,"keyup").pipe((0,b.R)(this.destroy$)).subscribe(()=>this.stop()),(0,g.R)(this.inputElement.nativeElement,"keydown").pipe((0,b.R)(this.destroy$)).subscribe(t=>{const{keyCode:n}=t;n!==N.LH&&n!==N.JH&&n!==N.K5||this.ngZone.run(()=>{if(n===N.LH){const s=this.getRatio(t);this.up(t,s),this.stop()}else if(n===N.JH){const s=this.getRatio(t);this.down(t,s),this.stop()}else this.updateDisplayValue(this.value);this.cdr.markForCheck()})})})}ngOnChanges(t){const{nzStatus:n,nzDisabled:s}=t;if(t.nzFormatter&&!t.nzFormatter.isFirstChange()){const a=this.getCurrentValidValue(this.parsedValue);this.setValue(a),this.updateDisplayValue(a)}s&&this.disabled$.next(this.nzDisabled),n&&this.setStatusStyles(this.nzStatus,this.hasFeedback)}ngAfterViewInit(){this.nzAutoFocus&&this.focus()}ngOnDestroy(){this.focusMonitor.stopMonitoring(this.elementRef)}setupHandlersListeners(){this.ngZone.runOutsideAngular(()=>{(0,R.T)((0,g.R)(this.upHandler.nativeElement,"mouseup"),(0,g.R)(this.upHandler.nativeElement,"mouseleave"),(0,g.R)(this.downHandler.nativeElement,"mouseup"),(0,g.R)(this.downHandler.nativeElement,"mouseleave")).pipe((0,b.R)(this.destroy$)).subscribe(()=>this.stop())})}setStatusStyles(t,n){this.status=t,this.hasFeedback=n,this.cdr.markForCheck(),this.statusCls=(0,z.Zu)(this.prefixCls,t,n),Object.keys(this.statusCls).forEach(s=>{this.statusCls[s]?this.renderer.addClass(this.elementRef.nativeElement,s):this.renderer.removeClass(this.elementRef.nativeElement,s)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.R0b),e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(w.tE),e.Y36(e.Qsj),e.Y36(P.Is,8),e.Y36(M.kn),e.Y36(y.kH,8),e.Y36(y.yW,8))},i.\u0275cmp=e.Xpm({type:i,selectors:[["nz-input-number"]],viewQuery:function(t,n){if(1&t&&(e.Gf(L,7),e.Gf(U,7),e.Gf(J,7)),2&t){let s;e.iGM(s=e.CRH())&&(n.upHandler=s.first),e.iGM(s=e.CRH())&&(n.downHandler=s.first),e.iGM(s=e.CRH())&&(n.inputElement=s.first)}},hostAttrs:[1,"ant-input-number"],hostVars:16,hostBindings:function(t,n){2&t&&e.ekj("ant-input-number-in-form-item",!!n.nzFormStatusService)("ant-input-number-focused",n.isFocused)("ant-input-number-lg","large"===n.nzSize)("ant-input-number-sm","small"===n.nzSize)("ant-input-number-disabled",n.nzDisabled)("ant-input-number-readonly",n.nzReadOnly)("ant-input-number-rtl","rtl"===n.dir)("ant-input-number-borderless",n.nzBorderless)},inputs:{nzSize:"nzSize",nzMin:"nzMin",nzMax:"nzMax",nzParser:"nzParser",nzPrecision:"nzPrecision",nzPrecisionMode:"nzPrecisionMode",nzPlaceHolder:"nzPlaceHolder",nzStatus:"nzStatus",nzStep:"nzStep",nzInputMode:"nzInputMode",nzId:"nzId",nzDisabled:"nzDisabled",nzReadOnly:"nzReadOnly",nzAutoFocus:"nzAutoFocus",nzBorderless:"nzBorderless",nzFormatter:"nzFormatter"},outputs:{nzBlur:"nzBlur",nzFocus:"nzFocus"},exportAs:["nzInputNumber"],features:[e._Bn([{provide:p.JU,useExisting:(0,e.Gpc)(()=>i),multi:!0},M.kn]),e.TTD],decls:11,vars:15,consts:[[1,"ant-input-number-handler-wrap"],["unselectable","unselectable",1,"ant-input-number-handler","ant-input-number-handler-up",3,"mousedown"],["upHandler",""],["nz-icon","","nzType","up",1,"ant-input-number-handler-up-inner"],["unselectable","unselectable",1,"ant-input-number-handler","ant-input-number-handler-down",3,"mousedown"],["downHandler",""],["nz-icon","","nzType","down",1,"ant-input-number-handler-down-inner"],[1,"ant-input-number-input-wrap"],["autocomplete","off",1,"ant-input-number-input",3,"disabled","placeholder","readOnly","ngModel","ngModelChange"],["inputElement",""],["class","ant-input-number-suffix",3,"status",4,"ngIf"],[1,"ant-input-number-suffix",3,"status"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"span",1,2),e.NdJ("mousedown",function(a){return n.up(a)}),e._UZ(3,"span",3),e.qZA(),e.TgZ(4,"span",4,5),e.NdJ("mousedown",function(a){return n.down(a)}),e._UZ(6,"span",6),e.qZA()(),e.TgZ(7,"div",7)(8,"input",8,9),e.NdJ("ngModelChange",function(a){return n.onModelChange(a)}),e.qZA()(),e.YNc(10,$,1,1,"nz-form-item-feedback-icon",10)),2&t&&(e.xp6(1),e.ekj("ant-input-number-handler-up-disabled",n.disabledUp),e.xp6(3),e.ekj("ant-input-number-handler-down-disabled",n.disabledDown),e.xp6(4),e.Q6J("disabled",n.nzDisabled)("placeholder",n.nzPlaceHolder)("readOnly",n.nzReadOnly)("ngModel",n.displayValue),e.uIk("id",n.nzId)("autofocus",n.nzAutoFocus?"autofocus":null)("min",n.nzMin)("max",n.nzMax)("step",n.nzStep)("inputmode",n.nzInputMode),e.xp6(2),e.Q6J("ngIf",n.hasFeedback&&!!n.status&&!n.nzFormNoStatusService))},dependencies:[x.O5,p.Fj,p.JJ,p.On,F.Ls,y.w_],encapsulation:2,changeDetection:0}),(0,v.gn)([(0,z.yF)()],i.prototype,"nzDisabled",void 0),(0,v.gn)([(0,z.yF)()],i.prototype,"nzReadOnly",void 0),(0,v.gn)([(0,z.yF)()],i.prototype,"nzAutoFocus",void 0),(0,v.gn)([(0,z.yF)()],i.prototype,"nzBorderless",void 0),i})(),rt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[P.vT,x.ez,p.u5,V.T,F.PV,y.mJ]}),i})();var C=o(3599),G=o(2612),Z=o(9662),ot=o(3877),at=o(8145),ut=o(5993),pt=o(3460),lt=o(9515),dt=o(6644),ct=o(855),ft=o(1958),E=o(95);let mt=(()=>{class i{constructor(t,n,s,a,u,f,h){this.location=t,this.fb=n,this.route=s,this.productService=a,this.message=u,this.translate=f,this.fileService=h,this.loading=!1,this.id="",this.submitLoading=!1,this.fileList=[],this.beforeUploadHandler=(l,c)=>c.slice(0,5-this.fileList.length).some(I=>I.uid===l.uid),this.customRequestHandler=l=>{const c=l.file.uid;return this.fileService.upload(l.file,d=>{l.onProgress&&l.onProgress({percent:d},l.file)}).subscribe({next:d=>{const m=this.fileList.findIndex(I=>I.uid===c);m>-1&&this.fileList.splice(m,1,{uid:c,name:"",status:"done",url:d}),l.onSuccess&&l.onSuccess(d,l.file,null)},error:()=>{const d=this.fileList.findIndex(m=>m.uid===c);d>-1&&this.fileList.splice(d,1,{uid:c,name:"",status:"error",url:""}),l.onError&&l.onError(!1,l.file)}})}}ngOnInit(){this.form=this.fb.group({name:["",p.kI.required],brand:["",p.kI.required],category:["",p.kI.required],price:[0,p.kI.required],color:["",p.kI.required],inventory:[0,p.kI.required],style:["",p.kI.required],enable:[!0],describe:[""],images:[[]]}),this.id=this.route.snapshot.paramMap.get("id")??"",this.id&&(this.loading=!0,this.productService.getProductById(this.id).subscribe({next:t=>{const{name:n,brand:s,category:a,price:u,color:f,inventory:h,style:l,enable:c,describe:d,images:m}=t.data;this.form.setValue({name:n,brand:s,category:a,price:u,color:f,inventory:h,style:l,enable:c,describe:d,images:m}),this.fileList=m.map((I,zt)=>({uid:`${zt}`,name:"",status:"done",url:I})),this.loading=!1},error:()=>{this.loading=!1}}))}backHandler(){this.location.back()}saveHandler(){if(this.form.valid){const t=this.form.value;this.submitLoading=!0,this.id&&(t._id=this.id);const n=[];this.fileList.forEach(s=>{"done"===s.status&&n.push(s.url)}),t.images=n,this.productService.saveProduct(t).subscribe({next:()=>{this.translate.get("save").subscribe(s=>{this.translate.get("whatSuccess",{value:s}).subscribe(a=>{this.submitLoading=!1,ot.y.next(!0),this.message.success(a),this.location.back()})})},error:()=>{this.submitLoading=!1}})}else Object.values(this.form.controls).forEach(t=>{t.invalid&&(t.markAsDirty(),t.updateValueAndValidity({onlySelf:!0}))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(x.Ye),e.Y36(p.QS),e.Y36(at.gz),e.Y36(ut.M),e.Y36(pt.dD),e.Y36(lt.sK),e.Y36(dt.I))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-product-add-or-edit"]],standalone:!0,features:[e.jDz],decls:71,vars:29,consts:[["nzBackIcon","",3,"nzTitle","nzBack"],["nz-button","","nzType","primary",3,"nzLoading","click"],[3,"nzLoading"],["nz-form","",3,"formGroup"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzRequired","","nzFor","name"],["nzErrorTip","\u8bf7\u8f93\u5165\u540d\u79f0"],["nz-input","","formControlName","name","id","name"],["nzRequired","","nzFor","brand"],["nzErrorTip","\u8bf7\u8f93\u5165\u54c1\u724c"],["nz-input","","formControlName","brand","id","brand"],["nzRequired","","nzFor","category"],["nzErrorTip","\u8bf7\u8f93\u5165\u7c7b\u522b"],["nz-input","","formControlName","category","id","category"],["nzRequired","","nzFor","price"],["nzErrorTip","\u8bf7\u8f93\u5165\u4ef7\u683c"],["formControlName","price","nzId","price",2,"width","100%",3,"nzMin","nzPrecision"],["nzRequired","","nzFor","color"],["nzErrorTip","\u8bf7\u8f93\u5165\u989c\u8272"],["nz-input","","formControlName","color","id","color"],["nzRequired","","nzFor","inventory"],["nzErrorTip","\u8bf7\u8f93\u5165\u5e93\u5b58"],["formControlName","inventory","nzId","inventory",2,"width","100%",3,"nzMin","nzPrecision"],["nzRequired","","nzFor","style"],["nzErrorTip","\u8bf7\u8f93\u5165\u6b3e\u5f0f"],["nz-input","","formControlName","style","id","style"],["nzFor","enable"],["nz-checkbox","","formControlName","enable","nzId","enable"],["nzFor","describe"],["formControlName","describe","nz-input","","id","describe"],["nzAccept","image/*","nzListType","picture-card","nzMultiple","",3,"nzFileList","nzCustomRequest","nzBeforeUpload","nzShowButton","nzLimit","nzFileListChange"],["nz-icon","","nzType","plus"]],template:function(t,n){1&t&&(e.TgZ(0,"nz-page-header",0),e.NdJ("nzBack",function(){return n.backHandler()}),e.ALo(1,"async"),e.TgZ(2,"nz-page-header-extra")(3,"button",1),e.NdJ("click",function(){return n.saveHandler()}),e._uU(4),e.ALo(5,"async"),e.qZA()(),e.TgZ(6,"nz-page-header-content")(7,"nz-skeleton",2)(8,"form",3)(9,"div",4)(10,"div",5)(11,"nz-form-item")(12,"nz-form-label",6),e._uU(13,"\u540d\u79f0"),e.qZA(),e.TgZ(14,"nz-form-control",7),e._UZ(15,"input",8),e.qZA()()(),e.TgZ(16,"div",5)(17,"nz-form-item")(18,"nz-form-label",9),e._uU(19,"\u54c1\u724c"),e.qZA(),e.TgZ(20,"nz-form-control",10),e._UZ(21,"input",11),e.qZA()()(),e.TgZ(22,"div",5)(23,"nz-form-item")(24,"nz-form-label",12),e._uU(25,"\u7c7b\u522b"),e.qZA(),e.TgZ(26,"nz-form-control",13),e._UZ(27,"input",14),e.qZA()()(),e.TgZ(28,"div",5)(29,"nz-form-item")(30,"nz-form-label",15),e._uU(31,"\u4ef7\u683c"),e.qZA(),e.TgZ(32,"nz-form-control",16),e._UZ(33,"nz-input-number",17),e.qZA()()(),e.TgZ(34,"div",5)(35,"nz-form-item")(36,"nz-form-label",18),e._uU(37,"\u989c\u8272"),e.qZA(),e.TgZ(38,"nz-form-control",19),e._UZ(39,"input",20),e.qZA()()(),e.TgZ(40,"div",5)(41,"nz-form-item")(42,"nz-form-label",21),e._uU(43,"\u5e93\u5b58"),e.qZA(),e.TgZ(44,"nz-form-control",22),e._UZ(45,"nz-input-number",23),e.qZA()()(),e.TgZ(46,"div",5)(47,"nz-form-item")(48,"nz-form-label",24),e._uU(49,"\u6b3e\u5f0f"),e.qZA(),e.TgZ(50,"nz-form-control",25),e._UZ(51,"input",26),e.qZA()()(),e.TgZ(52,"div",5)(53,"nz-form-item")(54,"nz-form-label",27),e._uU(55,"\u662f\u5426\u542f\u7528"),e.qZA(),e.TgZ(56,"nz-form-control"),e._UZ(57,"span",28),e.qZA()()(),e.TgZ(58,"div",5)(59,"nz-form-item")(60,"nz-form-label",29),e._uU(61,"\u63cf\u8ff0"),e.qZA(),e.TgZ(62,"nz-form-control"),e._UZ(63,"textarea",30),e.qZA()()(),e.TgZ(64,"div",5)(65,"nz-form-item")(66,"nz-form-label"),e._uU(67,"\u56fe\u7247"),e.qZA(),e.TgZ(68,"nz-form-control")(69,"nz-upload",31),e.NdJ("nzFileListChange",function(a){return n.fileList=a}),e._UZ(70,"span",32),e.qZA()()()()()()()()()),2&t&&(e.Q6J("nzTitle",e.lcZ(1,25,n.translate.get(n.id?"edit":"add"))),e.xp6(3),e.Q6J("nzLoading",n.submitLoading),e.xp6(1),e.hij(" ",e.lcZ(5,27,n.translate.get("save"))," "),e.xp6(3),e.Q6J("nzLoading",n.loading),e.xp6(1),e.Q6J("formGroup",n.form),e.xp6(1),e.Q6J("nzGutter",24),e.xp6(1),e.Q6J("nzSpan",8),e.xp6(6),e.Q6J("nzSpan",8),e.xp6(6),e.Q6J("nzSpan",8),e.xp6(6),e.Q6J("nzSpan",8),e.xp6(5),e.Q6J("nzMin",0)("nzPrecision",2),e.xp6(1),e.Q6J("nzSpan",8),e.xp6(6),e.Q6J("nzSpan",8),e.xp6(5),e.Q6J("nzMin",0)("nzPrecision",0),e.xp6(1),e.Q6J("nzSpan",8),e.xp6(6),e.Q6J("nzSpan",16),e.xp6(6),e.Q6J("nzSpan",24),e.xp6(6),e.Q6J("nzSpan",24),e.xp6(5),e.Q6J("nzFileList",n.fileList)("nzCustomRequest",n.customRequestHandler)("nzBeforeUpload",n.beforeUploadHandler)("nzShowButton",n.fileList.length<5)("nzLimit",5))},dependencies:[x.ez,x.Ov,p.UX,p._Y,p.Fj,p.JJ,p.JL,p.sg,p.u,S.KJ,S.$O,S.u5,S.Jp,D.q6,A.H0,A.ng,O.sL,O.ix,ct.w,ft.dQ,T.o7,T.Zp,rt,st,C.U5,E.t3,E.SK,C.Lr,C.Nx,C.iK,C.Fd,Z.cS,Z.FY,F.PV,F.Ls,G.Wr,G.Ie]}),i})()}}]);